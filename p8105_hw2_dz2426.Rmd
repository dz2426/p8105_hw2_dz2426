---
title: "p8105_hw2_dz2426"
author: "Duzhi Zhao"
date: "9/24/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(readxl)
```

## Problem 1
# Section 1.1 Clean dataset "Mr.Trash Wheel"
```{r message = FALSE}
# Load in Mr.Trash Wheel dataset
MTW_data = read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = 1) %>%
  janitor::clean_names() %>% 
  drop_na(dumpster) %>%  #remove NA 
  select(-x15) %>%     #remove the last column with notes
  mutate(
    sports_balls = round(sports_balls, digits = 0) %>% #round to nearest integer
      as.integer()    #change type from double to integer
  )
```
# Section 1.2 Clean datasets "2017 & 2018 Precipitation"
```{r}
# Load in and clean Precipitation 2017 dataset
Precip_2017 = read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = 4, skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(
    year = 2017       #add variabel year
  )

# Load in and clean Precipitation 2018 dataset
Precip_2018 = read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = 3, skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(total, month) %>%
  mutate(
    year = 2018         
  )

# Combine two datasets
Combine_ds = 
  bind_rows(Precip_2017, Precip_2018) %>% 
  janitor::clean_names() %>% 
  arrange(month) %>%   #list data in the order of month
  rename(total_in = total) %>%   #include units ("inches") for total precipitation
  mutate(
    month = as.character(month.abb[month])  #change month to character and correspond each number to its abbreviation
  )

```
Comment 1: <br />

The resulting Mr.Trash Wheel dataset (MTW_data) includes `r dim(MTW_data)[1]` observations and `r dim(MTW_data)[2]` variables. Variables include dumpster number, date of collection, amount of total and litter type, and categories of the items (e.g. sports balls and plastic bottles). <br />

The combined precipitation data (Combine_ds) includes `r dim(Combine_ds)[1]` observations and `r dim(Combine_ds)[2]` variables, including month, total precipitation, and the year of precipitation. <br />

The total precipitation in 2018 was `r sum(pull(Precip_2018, total))` inches. <br />
The median number of sports balls in a dumpster in 2017 was `r median(pull(MTW_data, sports_balls)[pull(MTW_data,year) == 2017])`.

## Problem 2
# Section 2.1 Clean dataset "pols_month.csv"
```{r message = FALSE}
# Load in pols_month.csv
pols_data = read_csv("./data/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(col = mon, into = c("year", "month", "day")) %>% 
  mutate(
    month = as.double(month),
    month = as.character(month.abb[month]), #change to month_name
    president = ifelse(prez_gop == TRUE, "republican", "democratic")
  ) %>% #use logical statement to combine "rep" and "dem"
  select(-c(day, prez_gop, prez_dem)) #drop three volumns


```

# Section 2.2 Clean dataset "snp.csv"
```{r message = FALSE}
snp_data = read_csv("./data/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(col = date, into = c("month", "day", "year")) %>% 
  select(-day) %>% 
  mutate(
    month = as.double(month),
    month = as.character(month.abb[month]) #change to month name
  ) %>% 
  select(year, month, close) #put year and month as leading columns

```

# Section 2.3 Clean dataset "unemployment.csv"
```{r message = FALSE}
unemp_data = read_csv("./data/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "percent_unemployment"
  ) #wide to long
```

# Section 2.4 Merge three datasets
```{r}
# Merge snp.csv and pols_data first
first_merged = 
  full_join(pols_data, snp_data, by = c("year", "month")) %>% 
  #fully combine data by year and month
  janitor::clean_names() %>% 
  mutate(
    year = as.numeric(year), 
    #Change to the same variable type for combining with unemp_data
    month = str_to_lower(month)
    #ensure same format as in unemp_data
)

# Merge the unemp_data into the above dataset 
final_merged = 
  full_join(first_merged, unemp_data, by = c("year", "month")) %>% 
  janitor::clean_names()

```

